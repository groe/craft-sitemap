{% import '_includes/forms' as forms %}

{% set frequencyOptions = {
  always:  'always',
  hourly:  'hourly',
  daily:   'daily',
  weekly:  'weekly',
  monthly: 'monthly',
  yearly:  'yearly',
  never:   'never',
} %}

{% set priorityOptions = {
  '1.0': '1.0',
  '0.9': '0.9',
  '0.8': '0.8',
  '0.7': '0.7',
  '0.6': '0.6',
  '0.5': '0.5',
  '0.4': '0.4',
  '0.3': '0.3',
  '0.2': '0.2',
  '0.1': '0.1',
  '0.0': '0.0',
} %}

{% set includeIfFieldOptions = { '': '' } %}

{% for field in craft.fields.getAllFields() %}
  {% if field.type == 'Lightswitch' %}
    {% set includeIfFieldOptions = includeIfFieldOptions | merge( { (field.handle) : field.name } ) %}
  {% endif %}
{% endfor %}
<table class="data fullwidth">
  <thead>
    <th>{{ 'Enabled'          | translate( 'sitemap' ) }}</th>
    <th>{{ 'Section'          | translate( 'sitemap' ) }} </th>
    <th>{{ 'URL Format'       | translate( 'sitemap' ) }}</th>
    <th>{{ 'Include if...'    | translate( 'sitemap' ) }}</th>
    <th>{{ 'Entries'          | translate( 'sitemap' ) }}</th>
    <th>{{ 'Change Frequency' | translate( 'sitemap' ) }}</th>
    <th>{{ 'Priority'         | translate( 'sitemap' ) }}</th>
  </thead>
  <tbody>
  {% for section in sections %}
    <tr>
      <td>
        {{- forms.checkbox( {
          name:    "enabled[#{section.id}]",
          value:   true,
          checked: settings.sections[ section.id ] is defined
        } ) -}}
      </td>
      <td>
        {{- section -}}
      </td>
      <td dir="ltr">
        {%- if section.isHomepage() -%}
          <div data-icon="home" title="{{ 'Homepage' | translate( 'sitemap' ) }}"></div>
        {%- else -%}
          {{ section.urlFormat }}
        {%- endif -%}
      </td>
      <td>
        {{- forms.selectField( {
          name:    "includeiffield[#{section.id}]",
          options: includeIfFieldOptions,
          value:   settings.sections[ section.id ].includeiffield | default('')
        } ) -}}
      </td>
      <td>
        {{- craft.entries.section( section ).total() -}}
      </td>
      <td>
        {{- forms.selectField( {
          name:    "changefreq[#{section.id}]",
          options: frequencyOptions,
          value:   settings.sections[ section.id ].changefreq | default( 'weekly' )
        } ) -}}
      </td>
      <td>
        {{- forms.selectField( {
          name:    "priority[#{section.id}]",
          options: priorityOptions,
          value:   settings.sections[ section.id ].priority | default( section.isHomepage() ? '1.0' : '0.5' )
        } ) -}}
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>
